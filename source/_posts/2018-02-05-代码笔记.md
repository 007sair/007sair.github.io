---
title: 代码笔记
date: 2018-02-05 17:20:39
tags:
 - javascript
categories:
 - javascript
---

## 关于内核

- `webkit`内核的浏览器，比如`chrome`，`safari`的css3前缀为`-webkit-transform`
- `Gecko`内核的浏览器，如`firefox`支持的css3前缀为`-moz-transform`
- `Trident`内核的浏览器，如`IE`支持的css3前缀为`-ms-transform`
- `Presto`内核浏览器，如`Opera`支持的css3前缀为`-o-transform`

<!-- more -->

## css前缀相关

``` js
// 获取到一个CSSStyleDeclaration对象，它是一个CSS属性键值对的集合。
var divstyle = document.createElement('div').style;

/**
 * 将css前缀转为驼峰规则，如：-webkit-box-pack -> WebkitBoxPack
 * @param {string} str css写法前缀
 */
function camelCase(str) {
    return (str + '').replace(/^-ms-/, 'ms-').replace(/-([a-z]|[0-9])/ig, function(all, letter) {
        return (letter + '').toUpperCase();
    })
}

/**
 * 将驼峰写法前缀转换为 -xx- 写法
 * @param {string} str 驼峰式写法
 */
function uncamelCase(str) {
    return str.replace(/([A-Z]|^ms)/g, "-$1").toLowerCase();
}

/**
 * 返回当前浏览器的前缀，如：chrome下返回 -webkit-  字符串
 */
function cssVender() {
    var ds = divstyle,
        cases = ['-webkit-', '-moz-', '-ms-', '-o-', ''],
        i = 0;
    do {
        if (camelCase(cases[i] + 'transform') in ds) {
            return cases[i];
        }
    } while (++i < cases.length);
    return '';
}

/**
 * 返回浏览器支持的带前缀属性，如：chrome下，box-pack -> -webkit-box-pack
 * @param {string} property 传入的css属性名
 */
function fixCSS(property) {
    var ds = divstyle,
        pre = cssVender();
    return (camelCase(property) in ds) && property || (camelCase(pre + property) in ds) && pre + property || property;
}

/**
 * 返回js特性的前缀，如：chrome下，box-pack -> WebkitBoxPack
 * @param {string} property 传入css属性名
 */
function isCSS(property) {
    var name = camelCase(fixCSS(property));
    return (name in divstyle) && name || '';
}
```

## 获取元素的宽高等

方法1：

``` js
var testElement = document.querySelector('.test'),
    width = testElement.offsetWidth,
    height = testElement.offsetHeight,
    left = testElement.offsetLeft,
    top = testElement.offsetTop;
```

方法2：

``` js
// IE中调用该方法的返回对象没有width， height这两个属性，因此做了简单的兼容处理
var rect = testElement.getBoundingClientRect(),
    top = rect.top,
    left = rect.left,
    right = rect.right,
    bottom = rect.bottom,
    width = rect.width || (right - left),
    height = rect.height || (bottom - top);
```

注意，`obj.offsetTop`属性获取的值是绝对的，不会随页面滚动而发生变化。但`getBoundingClientRect()`获取的`top`和`left`属性值是相对于视窗的，会随浏览器滚动而发生变化，若要跟offsetTop一样的效果，可以做如下处理：

``` js
var elem = document.querySelector('.btn');

window.addEventListener('scroll', function () {
    var scrollTop = (((t = document.documentElement) || (t = document.body.parentNode)) && typeof t.scrollTop == 'number' ? t : document.body).scrollTop;
    var scrollLeft = (((t = document.documentElement) || (t = document.body.parentNode)) && typeof t.scrollLeft == 'number' ? t : document.body).scrollLeft;

    var rect = elem.getBoundingClientRect();

    console.log(elem.offsetTop);
    console.log(rect.top + scrollTop);
})
```

注意：`offsetTop`获取的值为整数，而`getBoundingClientRect().top`获取到的值有可能是小数，四舍五入后与`offsetTop`相同。

关于`getBoundingClientRect`的兼容性，查看[MDN - getBoundingClientRect](https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getBoundingClientRect)

## 使用js获取css样式问题

当我们在使用rem单位时，经常会碰到小数点的单位，而某些属性是不会拿到小数点单位的。测试如下：

``` js
var getStyle = function (obj, attr) {
    if (obj.currentStyle) { // ie6/7/8
        return obj.currentStyle[attr];
    } else { // 9+
        return getComputedStyle(obj, false)[attr];
    }
};

var testElem = document.getElementById('js-btn');
testElem.style.width = '98.5px';
console.log(getStyle(testElem, 'width')); // '98.5px'
console.log(testElem.offsetWidth); // 99
```